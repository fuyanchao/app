<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" >
<meta name="viewport" content="user-scalable=no, width=640">
<title>全新BMW M2锋芒上市</title>
<link rel="stylesheet" href="http://bmw2.static.thefront.com.cn/2016/m2_2016/demo/demo.css">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72255351-17', 'auto');
  ga('send', 'pageview');

</script>
<script>
	var ua = navigator.userAgent.toLowerCase();
	if(ua.indexOf('iphone')==-1 && ua.indexOf('android')==-1){
		location.href = 'pc.html';
	}
</script>
</head>
<body>
<div id="loading">
	<div id="load1"></div>
	<div id="load2"></div>
	<div id="load3"></div>
	<div id="load4"></div>
	<div id="load5"></div>
</div>
<div id="masker">
	<img src="http://bmw2.static.thefront.com.cn/2016/m2_2016/img/masker.jpg" alt="">
</div>
<div id="link">
	<a href="javascript:;" data-href="http://www.bmw.com.cn/cn_mobi/zh/insights/events/pool/m2/gigi/overview.html" id="btn"></a>
	<a href="javascript:;" data-href="http://www.bmw.com.cn/cn_mobi/zh/insights/events/pool/m2/registration_standalone.html?channel=m_wechat" id="btn1"></a>
</div>
<div class="video-wrapper js-video-wrapper">
	<div class="video-responsive">
		<video class="video js-video" webkit-playsinline muted>
			<source src="media/final.mp4" type="video/mp4">
		</video>
		<canvas class="canvas js-canvas"></canvas>
		<div class="video-timeline js-timeline">
			<div class="video-timeline-passed js-timeline-passed">
			</div>
		</div>
	</div>
</div>
<script src="http://bmw2.static.thefront.com.cn/2016/m2_2016/js/jquery.min.js"></script>
<script src="http://bmw2.static.thefront.com.cn/2016/m2_2016/js/hammer.min.js"></script>
<script src="http://bmw2.static.thefront.com.cn/2016/m2_2016/js/jquery.hammer.js"></script>
<script src="http://bmw2.static.thefront.com.cn/2016/m2_2016/js/jquery.transit.min.js"></script>
<script src="http://bmw2.static.thefront.com.cn/2016/m2_2016/js/canvas-video-player.js"></script>
<script>
	var isIphone = navigator.userAgent.toLowerCase().indexOf('iphone') >= 0;
	// var sound = document.createElement('audio');
	var ld=vd=0;
	// sound.src = 'media/sound.mp3';
	playOver();	
	if (isIphone) {
	    var canvasVideo = new CanvasVideoPlayer({
			videoSelector: '.js-video',
			canvasSelector: '.js-canvas',
			hideVideo: true,
			audio: true,
		});
	}else {
		vd = 1;
	    $('canvas').hide();
	    $('.video').remove();
	    $('.video-responsive').append('<video src="media/final.mp4" id="video" width="0" height="0" style="background:transparent;"></video>')

		$('#video').get(0).load();
		// $('#video').get(0).play();
		$('#video').get(0).addEventListener('canplaythrough',function(){
			
	    })

	    $('#video').on('ended',function(){
	    	showBtn();
	    	$('#video').remove();
	    })

	}
	
	function playOver(){
		$('#load1').transition({'opacity':1,delay:1000},500)
		$('#load2').transition({'opacity':1,delay:2000},500)
		$('#load3').transition({'opacity':1,delay:2000},500)
		$('#load4').transition({'opacity':1,delay:3000},function(){
			ld=1
			if(vd==1){
				$('#load5').transition({'opacity':1,delay:2000},function(){
					$('#loading').hide();
				})
			}
		})		
	}
	// function playOver(){
	// 	// $('#btn').show();
	// }
	function showBtn(){
		$('#link').show();
	}

	$('#masker').hammer().on('panup',function(e){
		//上滑
		var y = e.gesture.distance;
		// console.log(y)
		if(y>180){
			y = 180;
		}
		$('#masker>img').css({y:-y});
	})
	$('#masker').on('touchend',function(){
		$('#masker>img').transition({y:0},300,function(){
			$('#masker').fadeOut();
			
		});
		if(canvasVideo){
			canvasVideo.play();
		}else{
			$('#video').width(640).height(1040).get(0).play();
		}
	})

	$('#link a').on('touchend',function(){
		var href = $(this).data('href');
		location.href = href;
	})
	// $('#loading').on('touchend',function(){
	// 	location.reload(true);
	// })

	document.addEventListener('touchmove',function(e){
		e.preventDefault();
	})
</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
var shareConfig = {
	debug: false,
    appId: 'wxbba5954485cb06af',//php输出参数
    timestamp: '1465376883',//php输出参数
    nonceStr: 'e2bAjFjL6mmuqJZa',//php输出参数
    signature: 'aee1db2654d196f03d1c61b8e91f7d0ac40a18bc',//php输出参数
    jsApiList: [
    	'onMenuShareTimeline',
    	'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo'
    ]
}
var shareAllData = {
	title:'全新BMW M2即将上市',
	desc:'该新闻已被BMW M快速删除',
	imgUrl:'http://bmw2.thefront.com.cn/m2_2016/img/share.png',
	link:'http://bmw2.thefront.com.cn/m2_2016/'
}

wx.config(shareConfig);
wx.ready(function () {
    wx.onMenuShareAppMessage(shareAllData);
    wx.onMenuShareTimeline({
        title: shareAllData.desc,
        link: shareAllData.link,
        imgUrl: shareAllData.imgUrl
    });
});
</script>
</body>
</html>
